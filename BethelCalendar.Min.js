var BethelCalendar={token:"",useWebflowItemPages:!1,dates:{today:{},begin:{},end:{},weekBeginOffset:0,weekEndOffset:0},category:"",data:[],routes:{items:""},canvas:!1,templateDay:"",templateItem:"",currentView:"grid",init:function(a){window.cal=this,void 0!==a.token&&(cal.token=a.token),void 0!==a.items_endpoint&&(cal.routes.items=a.items_endpoint),void 0!==a.use_webflow_item_pages&&(cal.useWebflowItemPages=a.use_webflow_item_pages);var t=window.location.href,l=e=!1;t.indexOf("calendar-begin")>1&&null!=cal.getURLParameter("calendar-begin")&&(l=cal.getURLParameter("calendar-begin")),t.indexOf("calendar-end")>1&&null!=cal.getURLParameter("calendar-end")&&(e=cal.getURLParameter("calendar-end")),cal.dates.today=cal.dateCalc(0),cal.createDates(l,e),cal.canvas=cal.eID(a.canvas_id),cal.templateDay=a.template_day,cal.templateItem=a.template_item,1==a.autoload&&cal.createCalendar(),cal.uiFilterListeners()},createDates:function(e,a=!1){("Invalid Date"==(e=cal.dateCalc(0,e)).object&&(e=cal.dateCalc(0)),0==a)?a=cal.dateCalc(13,e.unformatted):("Invalid Date"==(a=cal.dateCalc(0,a)).object&&(a=cal.dateCalc(13,e.unformatted)),(a.object.getTime()-e.object.getTime())/864e5>30&&(a=cal.dateCalc(30,e.unformatted)));cal.dates.begin=e,cal.dates.end=a},createCalendar:function(){cal.canvas.innerHTML="",cal.data=[],cal.createDays();var e={begin:window.cal.dates.begin.unformatted,end:window.cal.dates.end.unformatted,category:window.cal.category,offset:0,limit:1e3};1==cal.useWebflowItemPages&&(e={offset:0,limit:100},window.cal.dataLoader(cal.createItems,e,cal.routes.items.replace("{fortnight_offset}",cal.dates.begin.fortnight_offset)),cal.dates.end.fortnight_offset!=cal.dates.begin.fortnight_offset&&window.cal.dataLoader(cal.createItems,e,cal.routes.items.replace("{fortnight_offset}",cal.dates.end.fortnight_offset)))},createDays:function(){cal.data=[];for(var e=new Date(cal.dates.begin.object);e<=new Date(cal.dates.end.object);e.setDate(e.getDate()+1)){var a=cal.dateCalc(0,e);cal.data[a.unformatted]={date:a.object,items:[]},cal.uiAddDay(a.object,"calendar-day-"+a.unformatted)}},createItems:function(e){e.forEach(function(e){void 0!==cal.data[e.start_date]&&0==cal.checkDuplicateItem(e)&&(cal.data[e.start_date].items.push(e),cal.uiAddItem("calendar-day-"+e.start_date,e))}),cal.uiVisibleDays()},checkDuplicateItem:function(e){return cal.data[e.start_date].items.some(function(a){return a.title===e.title&&a.details===e.details})},dataLoader:function(e,a=!1,t=!1,l="GET",n=!1){if(console.log("LOADING: "+t),"GET"==l||""==l){var c="";for(var r in a)c+=(""!=c?"&":"")+r+"="+encodeURIComponent(a[r]);c.length>0&&(t+="?"+c)}var i=new XMLHttpRequest;i.responseType="document",i.onreadystatechange=function(){if(4==this.readyState&&(cal.uiRemoveLoaders(),200==this.status))if(this.getResponseHeader("content-type").indexOf("json")>0);else if(1==cal.useWebflowItemPages)return e(cal.parseWebflowHTMLItems(i.responseXML))},i.open(l,t,!0),i.send(a)},parseWebflowHTMLItems:function(e){var a=[];return e.querySelectorAll(".data-calendar-item").forEach(function(e){var t=[];e.querySelectorAll(".data-category").forEach(function(e){t.push(e.innerHTML.replace("amp;",""))});var l={title:e.querySelectorAll(".data-title")[0].innerHTML,details:e.querySelectorAll(".data-details")[0].innerHTML.replace("amp;",""),start_date:e.querySelectorAll(".data-start-date")[0].innerHTML.substring(0,10),end_date:e.querySelectorAll(".data-end-date")[0].innerHTML,link:e.querySelectorAll("a")[0].href,categories:t};a.push(l)}),a},dateCalc:function(e,a=!1){var t=[];if("string"==typeof a||a instanceof String)var l=a.split("-"),n=new Date(l[0],l[1]-1,l[2]);else if(a instanceof Date)n=a;else n=new Date;n.setDate(n.getDate()+e);var c=n.getDate(),r=n.getMonth()+1,i=n.getFullYear();return t.formatted=r+"/"+c+"/"+i,t.unformatted=i+"-"+r.toString().padStart(2,0)+"-"+c.toString().padStart(2,0),t.object=n,cal.dates.today.object instanceof Date&&(t.weeks_offset=Math.floor((n-cal.dates.today.object)/6048e5),t.fortnight_offset=Math.floor(t.weeks_offset/2)),t},getURLParameter:function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},uiRemoveLoaders:function(){for(var e=cal.eClass("bethel-calendar-loader"),a=0,t=e.length;a<t;a++)e[a].remove()},uiAddDay:function(e,a,t=[]){var l=cal.templateDay;l=(l=(l=(l=(l=(l=(l=l.replace("{id}",a)).replace("{day-class}","calendar-day")).replace("{day-items-class}","calendar-day-items")).replace("{day}",e.getDate().toString().padStart(2,0))).replace("{weekday}",e.toLocaleString("en-US",{weekday:"long"}))).replace("{month}",e.toLocaleString("en-US",{month:"short"}))).replace("{items}",""),cal.canvas.innerHTML+=l,cal.uiVisibleDays()},uiAddItem:function(e,a){var t=cal.templateItem;t=(t=(t=t.replace("{link}",a.link)).replace("{title}",a.title)).replace("{details}",a.details);var l="";for(i=0;i<a.categories.length;i++)l+="|"+a.categories[0]+"|";t=t.replace("{categories}",l),cal.eID(e).getElementsByClassName("calendar-day-items")[0].innerHTML+=t},uiVisibleDays:function(){cal.canvas.querySelectorAll("div.calendar-day").forEach(function(e,a){var t=!1;e.querySelectorAll("div.calendar-list-item").forEach(function(e){0==e.classList.contains("calendar-hidden")&&(t=!0)}),0==t?e.classList.add("calendar-hidden"):e.classList.remove("calendar-hidden")})},uiVisibleCategory:function(e){cal.canvas.querySelectorAll("div.calendar-list-item").forEach(function(a){var t=a.getAttribute("categories");0==e.length||t.indexOf("|"+e+"|")>-1?a.classList.remove("calendar-hidden"):a.classList.add("calendar-hidden")}),cal.uiVisibleDays()},uiFilterListeners:function(){cal.eID("calendar-date-filter-go").addEventListener("click",function(){var a=e=!1,t=cal.eID("calendar-date-filter").value;(t=t.split("-"))[0]=t[0].trim(),void 0!==t[0]&&t[0].length>=8&&(t[0]=t[0].split("/"),a=t[0][2]+"-"+t[0][0]+"-"+t[0][1]),void 0!==t[1]&&t[1].length>=8?(t[1]=t[1].split("/"),e=t[1][2]+"-"+t[1][0]+"-"+t[1][1]):e=a,cal.createDates(a,e),cal.createCalendar()}),cal.eID("calendar-category-dropdown").querySelectorAll("a.calendar-category-link").forEach(function(e,a){e.addEventListener("click",function(e){e.preventDefault();var a=this.innerHTML.replace("&amp;","&");cal.eID("calendar-filter-category-text").innerHTML=a,"View All Categories"==a&&(a=""),cal.uiVisibleCategory(a)})}),cal.eID("toggle-list-view").addEventListener("click",()=>{cal.canvas.classList.add("list-view"),cal.currentView="list"}),cal.eID("toggle-grid-view").addEventListener("click",()=>{cal.canvas.classList.remove("list-view"),cal.currentView="grid"})},eID:function(e){return document.getElementById(e)},eClass:function(e){return document.getElementsByClassName(e)},eCreate:function(e){return document.createElement(e)}};